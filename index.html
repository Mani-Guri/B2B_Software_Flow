<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retailer Onboarding Process Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
        }

        .content-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }

        .summary-card {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .flow-card {
            flex: 2;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
            font-weight: 600;
        }

        h3 {
            color: #2a5298;
            margin: 20px 0 10px;
            font-weight: 600;
        }

        p {
            margin-bottom: 15px;
        }

        ul {
            padding-left: 20px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .status-table th, .status-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .status-table th {
            background-color: #f2f6fc;
            color: #1e3c72;
            font-weight: 600;
        }

        .status-table tr:nth-child(even) {
            background-color: #f9fafc;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .verified {
            background-color: #e7f6ec;
            color: #0a7146;
        }

        .not-verified {
            background-color: #fef3e2;
            color: #b54708;
        }

        .diagram-container {
            position: relative;
            margin: 20px 0;
            border: 2px solid #eaeaea;
            border-radius: 8px;
            overflow: auto;
            background: #f8fafc;
            max-height: 800px;
        }

        .mermaid {
            text-align: center;
            padding: 40px;
            min-width: 1200px;
            transition: transform 0.3s ease;
        }

        .diagram-controls {
            position: sticky;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 100;
            float: right;
            margin-bottom: 10px;
        }

        .control-btn {
            background: white;
            border: 2px solid #2a5298;
            color: #2a5298;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .control-btn:hover {
            background: #2a5298;
            color: white;
            transform: translateY(-2px);
        }

        .zoom-controls {
            position: sticky;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 100;
            float: right;
            margin-top: 10px;
        }

        .zoom-btn {
            background: white;
            border: 2px solid #1e3c72;
            color: #1e3c72;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .zoom-btn:hover {
            background: #1e3c72;
            color: white;
            transform: scale(1.1);
        }

        /* Fullscreen styles */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 9999;
            overflow: auto;
        }

        .fullscreen-mode .diagram-container {
            border: none;
            border-radius: 0;
            max-height: none;
            height: 100vh;
            margin: 0;
        }

        .fullscreen-mode .mermaid {
            padding: 60px;
            transform: scale(1.1);
            transform-origin: top left;
        }

        .fullscreen-mode .diagram-controls {
            position: fixed;
            top: 20px;
            right: 20px;
        }

        .fullscreen-mode .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }

        .close-fullscreen {
            background: #ff6b6b;
            border-color: #ff6b6b;
            color: white;
        }

        .close-fullscreen:hover {
            background: #ff3838;
            border-color: #ff3838;
        }

        .scroll-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 60, 114, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        .note-box {
            background-color: #f0f7ff;
            border-left: 4px solid #2a5298;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }

        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .point-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border-top: 4px solid #2a5298;
        }

        .point-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .flow-section {
            margin: 25px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .flow-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .flow-section h3::before {
            content: "➤";
            color: #2a5298;
        }

        .path-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .path-card {
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #eaeaea;
        }

        .path-card.verified-path {
            border-color: #0a7146;
            background: #f0f9f4;
        }

        .path-card.manual-path {
            border-color: #b54708;
            background: #fef6ef;
        }

        .path-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .path-card.verified-path h4::before {
            content: "✅";
        }

        .path-card.manual-path h4::before {
            content: "⚠️";
        }

        .validation-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        .validation-table th, .validation-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .validation-table th {
            background-color: #2a5298;
            color: white;
        }

        .validation-table tr:nth-child(even) {
            background-color: #f8fafc;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
        }

        @media (max-width: 768px) {
            .content-section {
                flex-direction: column;
            }
            
            .path-comparison {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
            
            .zoom-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .mermaid {
                min-width: 800px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Retailer Onboarding Process Flow</h1>
                <p class="subtitle">Complete workflow documentation for administrator-led retailer creation with automated verification and manual fallback processes.</p>
            </div>
        </header>

        <div class="content-section">
            <div class="summary-card">
                <h2>Process Summary</h2>
                
                <p>The retailer creation process is an administrative function designed to onboard new retailers into the system. The flow is initiated by an authenticated administrator and can proceed through two primary paths:</p>
                
                <div class="path-comparison">
                    <div class="path-card verified-path">
                        <h4>Verified Onboarding</h4>
                        <p>System automatically populates retailer details by validating PAN card against government API. Cross-references PAN with Aadhaar for identity verification.</p>
                        <ul>
                            <li>Uses PAN-Aadhaar linking</li>
                            <li>Auto-fills personal details</li>
                            <li>Higher security & trust</li>
                            <li>Fields locked after verification</li>
                        </ul>
                    </div>
                    <div class="path-card manual-path">
                        <h4>Manual Onboarding</h4>
                        <p>Fallback path used for insufficient wallet balance, API failure, or unlinked PAN-Aadhaar. Requires admin data entry with validations.</p>
                        <ul>
                            <li>Manual data entry</li>
                            <li>Used when APIs fail</li>
                            <li>Requires post-verification</li>
                            <li>All fields remain editable</li>
                        </ul>
                    </div>
                </div>
                
                <h3>Document Validation Rules</h3>
                <table class="validation-table">
                    <thead>
                        <tr>
                            <th>Document</th>
                            <th>Format Validation</th>
                            <th>Duplicate Check</th>
                            <th>Error Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>PAN Card</strong></td>
                            <td>AAAAA1111A (5 letters + 4 digits + 1 letter)</td>
                            <td>Check existing retailers</td>
                            <td>"Retailer ABC ID-XXXX exists with this PAN"</td>
                        </tr>
                        <tr>
                            <td><strong>Aadhaar Card</strong></td>
                            <td>12 digits, not starting with 0/1</td>
                            <td>Check existing retailers</td>
                            <td>"Retailer ABC ID-XXXX exists with this Aadhaar"</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>Final Status Overview</h3>
                <table class="status-table">
                    <thead>
                        <tr>
                            <th>Onboarding Path</th>
                            <th>Verification Status</th>
                            <th>Fields Editable?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Verified</strong></td>
                            <td><span class="badge verified">Verified</span></td>
                            <td>Only non-verified fields</td>
                        </tr>
                        <tr>
                            <td><strong>Manual</strong></td>
                            <td><span class="badge not-verified">Not Verified</span></td>
                            <td>All fields</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="note-box">
                    <p><strong>Note:</strong> The 'Electronic' agent type is unavailable for D2C (Direct-to-Consumer) retailer flows. Only 'Banking' and 'Travel' options are available.</p>
                </div>
            </div>
            
            <div class="flow-card">
                <h2>Process Flow Diagram</h2>
                <p>The following diagram illustrates the complete retailer onboarding workflow with all decision points, validations, and exception handling:</p>
                
                <div class="diagram-container" id="diagramContainer">
                    <div class="diagram-controls">
                        <button class="control-btn" onclick="toggleFullscreen()">
                            <span>⛶</span> Full Screen
                        </button>
                    </div>
                    
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomOut()">-</button>
                        <button class="zoom-btn" onclick="resetZoom()">⟳</button>
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                    </div>
                    
                    <div class="scroll-hint" id="scrollHint">
                        ← Scroll to view complete flowchart →
                    </div>
                    
                    <div class="mermaid" id="mainDiagram">
flowchart TD
    %% === STYLING ===
    classDef startEnd fill:#1e3c72,color:#fff,stroke:#1e3c72,stroke-width:2px
    classDef process fill:#2a5298,color:#fff,stroke:#2a5298,stroke-width:2px
    classDef decision fill:#ff6b6b,color:#fff,stroke:#ff6b6b,stroke-width:2px
    classDef input fill:#4ecdc4,color:#fff,stroke:#4ecdc4,stroke-width:2px
    classDef manual fill:#ff9f43,color:#fff,stroke:#ff9f43,stroke-width:2px
    classDef verified fill:#1dd1a1,color:#fff,stroke:#1dd1a1,stroke-width:2px
    classDef common fill:#a55eea,color:#fff,stroke:#a55eea,stroke-width:2px
    classDef stop fill:#ff3838,color:#fff,stroke:#ff3838,stroke-width:2px
    classDef aadhaarCheck fill:#54a0ff,color:#fff,stroke:#54a0ff,stroke-width:2px

    %% === INITIATION ===
    Start([🏁 START Retailer Onboarding]):::startEnd
    Start --> Login[Admin Login<br>with User ID & Password]:::process
    Login --> Nav[Navigate to<br>Manage Admin → Create Retailer]:::process
    Nav --> Agent[Select Agent Type<br>Banking or Travel]:::input

    %% === PAN VALIDATION ===
    Agent --> PAN[Enter PAN Card Number]:::input
    PAN --> PAN_Format{Format Check<br>AAAAA1111A}:::decision
    PAN_Format -->|❌ Invalid| FormatError[Show Format Error]:::stop
    PAN_Format -->|✅ Valid| PAN_Duplicate{Duplicate Check}:::decision
    
    PAN_Duplicate -->|❌ Already Exists| DuplicateError[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    PAN_Duplicate -->|✅ Unique| WalletCheck{Check Admin<br>Wallet Balance}:::decision

    FormatError --> Stop1[🛑 STOP]:::stop
    DuplicateError --> Stop2[🛑 STOP]:::stop

    %% === MAIN BRANCHING ===
    WalletCheck -->|❌ Insufficient| Path_B[💰 Manual Flow<br>Insufficient Balance]:::manual
    WalletCheck -->|✅ Sufficient| API_Check[📡 Call PAN API]:::process
    
    API_Check -->|❌ API Down| Path_C[🔧 Manual Flow<br>API Not Working]:::manual
    API_Check -->|✅ API Working| LinkCheck{PAN-Aadhaar<br>Linked?}:::decision

    %% === VERIFIED FLOW ===
    LinkCheck -->|✅ Yes| Path_A1[✅ Verified Flow<br>Auto Data Population]:::verified
    LinkCheck -->|❌ No| Path_A2[⚠️ Manual Fallback<br>PAN Not Linked]:::manual

    %% PATH A1 - VERIFIED FLOW
    Path_A1 --> AutoFill1[Auto-fill from API<br>Name, DOB, Address]:::verified
    AutoFill1 --> ManualCheck1{All Fields<br>Populated?}:::decision
    ManualCheck1 -->|❌ Missing Data| ManualFill1[Admin manually<br>completes missing fields]:::input
    ManualCheck1 -->|✅ Complete| AadhaarEntry1[Enter Aadhaar Number]:::input
    ManualFill1 --> AadhaarEntry1
    
    AadhaarEntry1 --> AadhaarFormat1{Aadhaar Format Check<br>12 digits, not starting 0/1}:::decision
    AadhaarFormat1 -->|❌ Invalid| AadhaarFormatError1[Show Format Error]:::stop
    AadhaarFormat1 -->|✅ Valid| AadhaarDuplicate1{Aadhaar Duplicate Check}:::aadhaarCheck
    
    AadhaarDuplicate1 -->|❌ Already Exists| AadhaarDuplicateError1[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    AadhaarDuplicate1 -->|✅ Unique| CrossVerify{Cross Verify<br>Last 4 digits match}:::decision
    
    CrossVerify -->|✅ Match| To_Common1[➡️ Proceed to Common Steps]:::common
    CrossVerify -->|❌ No Match| CrossError[Show Mismatch Error]:::stop
    
    AadhaarFormatError1 --> Stop3[🛑 STOP]:::stop
    AadhaarDuplicateError1 --> Stop4[🛑 STOP]:::stop
    CrossError --> Stop5[🛑 STOP]:::stop

    %% PATH A2 - MANUAL FALLBACK
    Path_A2 --> Message[Show Message:<br>PAN not linked with Aadhaar]:::manual
    Message --> AutoFill2[Auto-fill from PAN API<br>if available]:::manual
    AutoFill2 --> ManualFill2[Admin manually<br>enters all details]:::input
    ManualFill2 --> AadhaarEntry2[Enter Aadhaar Number]:::input
    AadhaarEntry2 --> AadhaarFormat2{Aadhaar Format Check<br>12 digits, not starting 0/1}:::decision
    AadhaarFormat2 -->|❌ Invalid| AadhaarFormatError2[Show Format Error]:::stop
    AadhaarFormat2 -->|✅ Valid| AadhaarDuplicate2{Aadhaar Duplicate Check}:::aadhaarCheck
    
    AadhaarDuplicate2 -->|❌ Already Exists| AadhaarDuplicateError2[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    AadhaarDuplicate2 -->|✅ Unique| To_Common2[➡️ Proceed to Common Steps]:::common
    
    AadhaarFormatError2 --> Stop6[🛑 STOP]:::stop
    AadhaarDuplicateError2 --> Stop7[🛑 STOP]:::stop

    %% PATH B & C - MANUAL FLOWS
    Path_B --> InsufficientMsg[Show: Insufficient Balance]:::manual
    Path_C --> APIDownMsg[Show: PAN API Down]:::manual
    
    InsufficientMsg --> ManualEntry_B[Manual Entry All Details]:::input
    APIDownMsg --> ManualEntry_C[Manual Entry All Details]:::input
    
    ManualEntry_B --> PAN_Val_B{PAN Validation}:::decision
    ManualEntry_C --> PAN_Val_C{PAN Validation}:::decision
    
    PAN_Val_B -->|❌ Invalid| Stop8[🛑 STOP]:::stop
    PAN_Val_B -->|✅ Valid| Aadhaar_Val_B{Aadhaar Validation}:::decision
    PAN_Val_C -->|❌ Invalid| Stop9[🛑 STOP]:::stop
    PAN_Val_C -->|✅ Valid| Aadhaar_Val_C{Aadhaar Validation}:::decision
    
    Aadhaar_Val_B -->|❌ Invalid| Stop10[🛑 STOP]:::stop
    Aadhaar_Val_B -->|✅ Valid| To_Common3[➡️ Proceed to Common Steps]:::common
    Aadhaar_Val_C -->|❌ Invalid| Stop11[🛑 STOP]:::stop
    Aadhaar_Val_C -->|✅ Valid| To_Common4[➡️ Proceed to Common Steps]:::common

    %% === COMMON STEPS ===
    To_Common1 --> Common
    To_Common2 --> Common
    To_Common3 --> Common
    To_Common4 --> Common
    
    subgraph Common [📋 COMMON ONBOARDING STEPS]
        C1[Contact Details Entry]:::common --> C2{Mobile & Email<br>Validation}:::decision
        C2 -->|✅ Format Valid| C3{Uniqueness Check}:::decision
        C3 -->|❌ Duplicate| C4[Show Error:<br>Mobile/Email already registered]:::stop
        C3 -->|✅ Unique| C5[Bank Details Entry]:::common
        
        C5 --> C6[Bank Validations<br>Account, IFSC, Bank Name]:::common
        C6 --> C7[Create Retailer Record<br>Generate Retailer ABC ID]:::common
    end
    
    C4 --> Stop12[🛑 STOP]:::stop
    C7 --> Status{Assign Final Status}:::decision

    %% === FINAL STATUS ===
    Status -->|From Path A1| Verified[✅ STATUS: VERIFIED<br>Green Badge - Non-clickable<br>Auto-filled fields LOCKED]:::verified
    Status -->|From Path A2/B/C| NotVerified[⚠️ STATUS: NOT VERIFIED<br>Gray Badge - Clickable<br>All fields editable]:::manual
    
    Verified --> End1[🎉 Onboarding Complete]:::startEnd
    NotVerified --> PostVerify[Post-Onboarding<br>Verification Available]:::manual
    
    PostVerify --> Click[Admin clicks 'Not Verified' badge]:::manual
    Click --> VerifyProcess{Run Verification Check}:::decision
    
    VerifyProcess -->|✅ PAN-Aadhaar Match| AutoVerify[Auto-Verify:<br>Verification Done]:::verified
    VerifyProcess -->|❌ PAN-Aadhaar Mismatch| Mismatch[Show: Details not matching<br>Admin can edit & retry]:::manual
    VerifyProcess -->|🔧 API Down| APIMessage[Show: API Down<br>Try again later]:::manual
    
    AutoVerify --> End2[🎉 Process Complete]:::startEnd
    Mismatch --> End3[🔄 Return to Edit]:::manual
    APIMessage --> End4[⏸️ Process Paused]:::manual
                    </div>
                </div>
                
                <div class="flow-section">
                    <h3>Diagram Controls</h3>
                    <p>Use the controls above the diagram to:</p>
                    <ul>
                        <li><strong>Full Screen:</strong> Expand the diagram to full screen starting from the beginning</li>
                        <li><strong>Zoom In/Out:</strong> Use + and - buttons to adjust the zoom level</li>
                        <li><strong>Reset Zoom:</strong> Click the reset button to return to default zoom</li>
                        <li><strong>Scroll:</strong> Use scroll bars to navigate through the complete flowchart</li>
                    </ul>
                </div>

                <div class="flow-section">
                    <h3>Enhanced Aadhaar Validation Process</h3>
                    <p><strong>New Aadhaar Duplicate Check:</strong> Similar to PAN card validation, the system now performs comprehensive Aadhaar validation:</p>
                    
                    <ul>
                        <li><strong>Format Validation:</strong> 12 digits, numeric only, cannot start with 0 or 1</li>
                        <li><strong>Duplicate Check:</strong> System-wide check for existing retailers with the same Aadhaar number</li>
                        <li><strong>Error Handling:</strong> Clear error message: "Retailer ABC ID-XXXX exists with this Aadhaar"</li>
                        <li><strong>Cross-Verification:</strong> In verified flow, matches last 4 digits with PAN API session data</li>
                    </ul>
                    
                    <p>This enhancement ensures no duplicate retailers can be created using the same Aadhaar number across all onboarding paths.</p>
                </div>

                <h3>Key Process Characteristics</h3>
                <ul>
                    <li><strong>Dual Path Flow:</strong> Automatically branches into Verified or Manual paths based on system checks</li>
                    <li><strong>Enhanced Document Validation:</strong> Both PAN and Aadhaar now have format + duplicate checks</li>
                    <li><strong>Progressive Validation:</strong> Each field validated for format and uniqueness in real-time</li>
                    <li><strong>Status-Driven Post-Processing:</strong> Verification status determines record editability</li>
                    <li><strong>Comprehensive Error Handling:</strong> Manages API failures, insufficient funds, and data mismatches</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>Retailer Onboarding Process Documentation | System Administration Guide | Updated with Enhanced Aadhaar Validation</p>
        </footer>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Zoom functionality
        let currentScale = 1;
        const diagram = document.getElementById('mainDiagram');
        const diagramContainer = document.getElementById('diagramContainer');
        const scrollHint = document.getElementById('scrollHint');

        function zoomIn() {
            if (currentScale < 2) {
                currentScale += 0.1;
                updateZoom();
            }
        }

        function zoomOut() {
            if (currentScale > 0.5) {
                currentScale -= 0.1;
                updateZoom();
            }
        }

        function resetZoom() {
            currentScale = 1;
            updateZoom();
            // Scroll to top-left to show the start of the diagram
            diagramContainer.scrollTo(0, 0);
        }

        function updateZoom() {
            diagram.style.transform = `scale(${currentScale})`;
            diagram.style.transformOrigin = '0 0';
        }

        // Fullscreen functionality
        let isFullscreen = false;

        function toggleFullscreen() {
            if (!isFullscreen) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            const container = document.querySelector('.flow-card');
            const originalParent = diagramContainer.parentNode;
            
            // Create fullscreen overlay
            const fullscreenOverlay = document.createElement('div');
            fullscreenOverlay.className = 'fullscreen-mode';
            fullscreenOverlay.id = 'fullscreenOverlay';
            
            // Move diagram container to fullscreen overlay
            fullscreenOverlay.appendChild(diagramContainer);
            document.body.appendChild(fullscreenOverlay);
            
            // Update controls
            const fullscreenBtn = document.querySelector('.control-btn');
            fullscreenBtn.innerHTML = '<span>✕</span> Exit Fullscreen';
            fullscreenBtn.classList.add('close-fullscreen');
            
            // Show scroll hint
            scrollHint.style.display = 'block';
            
            // Reset zoom and scroll to start
            resetZoom();
            diagramContainer.scrollTo(0, 0);
            
            isFullscreen = true;
            
            // Add keyboard event listener for escape
            document.addEventListener('keydown', handleFullscreenKeydown);
        }

        function exitFullscreen() {
            const fullscreenOverlay = document.getElementById('fullscreenOverlay');
            const flowCard = document.querySelector('.flow-card');
            
            if (fullscreenOverlay) {
                // Move diagram container back to original position
                flowCard.insertBefore(diagramContainer, flowCard.querySelector('.flow-section'));
                document.body.removeChild(fullscreenOverlay);
            }
            
            // Update controls
            const fullscreenBtn = document.querySelector('.control-btn');
            fullscreenBtn.innerHTML = '<span>⛶</span> Full Screen';
            fullscreenBtn.classList.remove('close-fullscreen');
            
            // Hide scroll hint
            scrollHint.style.display = 'none';
            
            // Reset zoom
            resetZoom();
            
            isFullscreen = false;
            
            // Remove keyboard event listener
            document.removeEventListener('keydown', handleFullscreenKeydown);
        }

        function handleFullscreenKeydown(e) {
            if (e.key === 'Escape' && isFullscreen) {
                exitFullscreen();
            }
        }

        // Hide scroll hint after 5 seconds
        setTimeout(() => {
            if (scrollHint) {
                scrollHint.style.opacity = '0';
                setTimeout(() => {
                    scrollHint.style.display = 'none';
                }, 1000);
            }
        }, 5000);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '=':
                    case '+':
                        e.preventDefault();
                        zoomIn();
                        break;
                    case '-':
                        e.preventDefault();
                        zoomOut();
                        break;
                    case '0':
                        e.preventDefault();
                        resetZoom();
                        break;
                }
            }
        });

        // Initialize diagram scroll position to start
        window.addEventListener('load', function() {
            diagramContainer.scrollTo(0, 0);
        });
    </script>
</body>
</html>
