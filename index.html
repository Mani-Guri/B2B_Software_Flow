<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retailer Onboarding Process Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
        }

        .content-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }

        .summary-card {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .flow-card {
            flex: 2;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
            font-weight: 600;
        }

        h3 {
            color: #2a5298;
            margin: 20px 0 10px;
            font-weight: 600;
        }

        p {
            margin-bottom: 15px;
        }

        ul {
            padding-left: 20px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 8px;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .status-table th, .status-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .status-table th {
            background-color: #f2f6fc;
            color: #1e3c72;
            font-weight: 600;
        }

        .status-table tr:nth-child(even) {
            background-color: #f9fafc;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .verified {
            background-color: #e7f6ec;
            color: #0a7146;
        }

        .not-verified {
            background-color: #fef3e2;
            color: #b54708;
        }

        .diagram-container {
            position: relative;
            margin: 20px 0;
            border: 2px solid #eaeaea;
            border-radius: 8px;
            background: #f8fafc;
            overflow: hidden;
            height: 700px;
        }

        .diagram-wrapper {
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 20px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            cursor: grab;
        }

        .diagram-wrapper.grabbing {
            cursor: grabbing;
        }

        .mermaid {
            text-align: center;
            transition: transform 0.3s ease;
            max-width: 100%;
            max-height: 100%;
            min-width: 100%;
            min-height: 100%;
            transform-origin: 0 0;
        }

        .diagram-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            background: white;
            border: 2px solid #2a5298;
            color: #2a5298;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .control-btn:hover {
            background: #2a5298;
            color: white;
            transform: translateY(-2px);
        }

        .zoom-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 100;
        }

        .zoom-btn {
            background: white;
            border: 2px solid #1e3c72;
            color: #1e3c72;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .zoom-btn:hover {
            background: #1e3c72;
            color: white;
            transform: scale(1.1);
        }

        /* Fullscreen styles */
        #fullscreenOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 9999;
        }

        #fullscreenOverlay.active {
            display: block;
        }

        #fullscreenOverlay .diagram-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: none;
            border-radius: 0;
            margin: 0;
        }

        #fullscreenOverlay .diagram-wrapper {
            padding: 40px;
        }

        #fullscreenOverlay .mermaid {
            transform: scale(1);
        }

        #fullscreenOverlay .diagram-controls {
            position: fixed;
            top: 20px;
            right: 20px;
        }

        #fullscreenOverlay .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }

        .close-fullscreen {
            background: #ff6b6b;
            border-color: #ff6b6b;
            color: white;
        }

        .close-fullscreen:hover {
            background: #ff3838;
            border-color: #ff3838;
        }

        .scroll-hint {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 60, 114, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            animation: bounce 2s infinite;
            z-index: 50;
            pointer-events: none;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        .zoom-level {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #1e3c72;
            font-weight: 600;
        }

        .control-hint {
            position: absolute;
            top: 60px;
            right: 10px;
            background: rgba(30, 60, 114, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            z-index: 50;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .control-hint.show {
            opacity: 1;
        }

        .note-box {
            background-color: #f0f7ff;
            border-left: 4px solid #2a5298;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }

        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .point-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border-top: 4px solid #2a5298;
        }

        .point-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .flow-section {
            margin: 25px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .flow-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .flow-section h3::before {
            content: "➤";
            color: #2a5298;
        }

        .path-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .path-card {
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #eaeaea;
        }

        .path-card.verified-path {
            border-color: #0a7146;
            background: #f0f9f4;
        }

        .path-card.manual-path {
            border-color: #b54708;
            background: #fef6ef;
        }

        .path-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .path-card.verified-path h4::before {
            content: "✅";
        }

        .path-card.manual-path h4::before {
            content: "⚠️";
        }

        .validation-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        .validation-table th, .validation-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .validation-table th {
            background-color: #2a5298;
            color: white;
        }

        .validation-table tr:nth-child(even) {
            background-color: #f8fafc;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
        }

        /* Custom scrollbar */
        .diagram-wrapper::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        .diagram-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 6px;
        }

        .diagram-wrapper::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 6px;
        }

        .diagram-wrapper::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .process-description {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2a5298;
        }

        .process-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eaeaea;
        }

        .step-number {
            background: #2a5298;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .enhanced-features {
            background: linear-gradient(135deg, #f0f7ff 0%, #e3f2fd 100%);
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            border: 2px solid #2a5298;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
        }

        .feature-item h5 {
            color: #1e3c72;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-item h5::before {
            content: "✓";
            color: #0a7146;
            font-weight: bold;
        }

        .additional-content {
            background: #f8fafc;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            border: 2px solid #eaeaea;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .content-block {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-top: 4px solid #2a5298;
        }

        .content-block h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content-block h4::before {
            content: "●";
            color: #2a5298;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .content-section {
                flex-direction: column;
            }
            
            .path-comparison {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
            
            .zoom-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .diagram-wrapper {
                padding: 10px;
            }
            
            .feature-grid, .content-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Retailer Onboarding Process Flow</h1>
                <p class="subtitle">Complete workflow documentation for administrator-led retailer creation with automated verification and manual fallback processes including enhanced Aadhaar validation.</p>
            </div>
        </header>

        <div class="content-section">
            <div class="summary-card">
                <h2>Process Overview</h2>
                
                <div class="process-description">
                    <p>The Retailer Onboarding Process is a comprehensive administrative workflow designed to securely onboard new retailers into the system. This process ensures data integrity through multiple validation layers and provides fallback mechanisms for various failure scenarios.</p>
                </div>

                <!-- Verified and Manual Onboarding Cards -->
                <div class="path-comparison">
                    <div class="path-card verified-path">
                        <h4>Verified Onboarding</h4>
                        <p>System automatically populates retailer details by validating PAN card against API. Cross-references PAN with Aadhaar for identity verification.</p>
                        <ul>
                            <li>Uses PAN-Aadhaar linking</li>
                            <li>Auto-fills personal details</li>
                            <!-- <li>Higher security & trust</li> -->
                            <li>Fields locked after verification</li>
                        </ul>
                    </div>
                    <div class="path-card manual-path">
                        <h4>Manual Onboarding</h4>
                        <p>Fallback path used for insufficient wallet balance, API failure, or unlinked PAN-Aadhaar. Requires admin data entry with validations.</p>
                        <ul>
                            <li>Manual data entry</li>
                            <li>Used when APIs fail</li>
                            <!-- <li>Requires post-verification</li> -->
                            <li>All fields remain editable</li>
                        </ul>
                    </div>
                </div>

                <h3>Key Process Steps</h3>
                
                <div class="process-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Administrator Authentication</h4>
                        <p>Secure login with user credentials and navigation to retailer creation module</p>
                    </div>
                </div>

                <div class="process-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>PAN Card Validation</h4>
                        <p>Format validation and duplicate checking against existing retailer database</p>
                    </div>
                </div>

                <div class="process-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>System Path Determination</h4>
                        <p>Automatic routing to verified or manual flow based on wallet balance and API availability</p>
                    </div>
                </div>

                <div class="process-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Aadhaar Validation & Duplicate Check</h4>
                        <p>Comprehensive Aadhaar verification including format validation and system-wide duplicate checking across all paths</p>
                    </div>
                </div>

                <div class="process-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Final Onboarding & Status Assignment</h4>
                        <p>Creation of retailer record with appropriate verification status and field locking rules</p>
                    </div>
                </div>

                <h3>Document Validation Rules</h3>
                <table class="validation-table">
                    <thead>
                        <tr>
                            <th>Document</th>
                            <th>Format Validation</th>
                            <th>Duplicate Check</th>
                            <th>Error Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>PAN Card</strong></td>
                            <td>AAAAA1111A (5 letters + 4 digits + 1 letter)</td>
                            <td>Check existing retailers</td>
                            <td>"Retailer ABC ID-XXXX exists with this PAN"</td>
                        </tr>
                        <tr>
                            <td><strong>Aadhaar Card</strong></td>
                            <td>12 digits, not starting with 0/1</td>
                            <td>Check existing retailers (ALL PATHS)</td>
                            <td>"Retailer ABC ID-XXXX exists with this Aadhaar"</td>
                        </tr>
                    </tbody>
                </table>
                
                <h3>Final Status Overview</h3>
                <table class="status-table">
                    <thead>
                        <tr>
                            <th>Onboarding Path</th>
                            <th>Verification Status</th>
                            <th>Fields Editable?</th>
                            <th>Verification Check</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Verified Flow</strong></td>
                            <td><span class="badge verified">Verified</span></td>
                            <td>Only non-verified fields</td>
                            <td>Format + Duplicate + Cross-Verification</td>
                        </tr>
                        <tr>
                            <td><strong>Manual Fallback</strong></td>
                            <td><span class="badge not-verified">Not Verified</span></td>
                            <td>All fields</td>
                            <td>Format + Duplicate</td>
                        </tr>
                        <tr>
                            <td><strong>API Down</strong></td>
                            <td><span class="badge not-verified">Not Verified</span></td>
                            <td>All fields</td>
                            <td>Format + Duplicate</td>
                        </tr>
                        <tr>
                            <td><strong>Insufficient Balance</strong></td>
                            <td><span class="badge not-verified">Not Verified</span></td>
                            <td>All fields</td>
                            <td>Format + Duplicate</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="note-box">
                    <p><strong>Important Note:</strong> The 'Electronic' agent type is unavailable for D2C (Direct-to-Consumer) retailer flows. Only 'Banking' and 'Travel' options are available. Aadhaar duplicate checking is now mandatory across all onboarding scenarios.</p>
                </div>
            </div>
            
            <div class="flow-card">
                <h2>Detailed Process Flow</h2>
                
                <div class="process-description">
                    <p>The following comprehensive flow diagram illustrates the complete retailer onboarding workflow with enhanced Aadhaar validation across all paths. The process automatically adapts to system conditions while maintaining data integrity through multiple validation layers.</p>
                </div>
                
                <!-- Main Diagram Container -->
                <div class="diagram-container" id="diagramContainer">
                    <div class="diagram-controls">
                        <button class="control-btn" onclick="toggleFullscreen()">
                            <span>⛶</span> Full Screen
                        </button>
                    </div>
                    
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomOut()">-</button>
                        <button class="zoom-btn" onclick="resetZoom()">⟳</button>
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                    </div>

                    <div class="zoom-level" id="zoomLevel">100%</div>
                    <div class="control-hint" id="controlHint">Hold Ctrl + Mouse Wheel to Zoom | Click + Drag to Pan</div>
                    
                    <div class="scroll-hint" id="scrollHint">
                        ↑ Scroll to view complete flowchart ↑
                    </div>
                    
                    <div class="diagram-wrapper" id="diagramWrapper">
                        <div class="mermaid" id="mainDiagram">
flowchart TD
    %% === STYLING ===
    classDef startEnd fill:#1e3c72,color:#fff,stroke:#1e3c72,stroke-width:2px
    classDef process fill:#2a5298,color:#fff,stroke:#2a5298,stroke-width:2px
    classDef decision fill:#ff6b6b,color:#fff,stroke:#ff6b6b,stroke-width:2px
    classDef input fill:#4ecdc4,color:#fff,stroke:#4ecdc4,stroke-width:2px
    classDef manual fill:#ff9f43,color:#fff,stroke:#ff9f43,stroke-width:2px
    classDef verified fill:#1dd1a1,color:#fff,stroke:#1dd1a1,stroke-width:2px
    classDef common fill:#a55eea,color:#fff,stroke:#a55eea,stroke-width:2px
    classDef stop fill:#ff3838,color:#fff,stroke:#ff3838,stroke-width:2px
    classDef aadhaarCheck fill:#54a0ff,color:#fff,stroke:#54a0ff,stroke-width:2px

    %% === INITIATION ===
    Start([🏁 START Retailer Onboarding]):::startEnd
    Start --> Login[Admin Login<br>with User ID & Password]:::process
    Login --> Nav[Navigate to<br>Manage Admin → Create Retailer]:::process
    Nav --> Agent[Select Agent Type<br>Banking or Travel]:::input

    %% === PAN VALIDATION ===
    Agent --> PAN[Enter PAN Card Number]:::input
    PAN --> PAN_Format{Format Check<br>AAAAA1111A}:::decision
    PAN_Format -->|❌ Invalid| FormatError[Show Format Error]:::stop
    PAN_Format -->|✅ Valid| PAN_Duplicate{Duplicate Check}:::decision
    
    PAN_Duplicate -->|❌ Already Exists| DuplicateError[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    PAN_Duplicate -->|✅ Unique| WalletCheck{Check Admin<br>Wallet Balance}:::decision

    FormatError --> Stop1[🛑 STOP]:::stop
    DuplicateError --> Stop2[🛑 STOP]:::stop

    %% === MAIN BRANCHING ===
    WalletCheck -->|❌ Insufficient| Path_B[💰 Manual Flow<br>Insufficient Balance]:::manual
    WalletCheck -->|✅ Sufficient| API_Check[📡 Call PAN API]:::process
    
    API_Check -->|❌ API Down| Path_C[🔧 Manual Flow<br>API Not Working]:::manual
    API_Check -->|✅ API Working| LinkCheck{PAN-Aadhaar<br>Linked?}:::decision

    %% === VERIFIED FLOW ===
    LinkCheck -->|✅ Yes| Path_A1[✅ Verified Flow<br>Auto Data Population]:::verified
    LinkCheck -->|❌ No| Path_A2[⚠️ Manual Fallback<br>PAN Not Linked]:::manual

    %% PATH A1 - VERIFIED FLOW
    Path_A1 --> AutoFill1[Auto-fill from API<br>Name, DOB, Address]:::verified
    AutoFill1 --> ManualCheck1{All Fields<br>Populated?}:::decision
    ManualCheck1 -->|❌ Missing Data| ManualFill1[Admin manually<br>completes missing fields]:::input
    ManualCheck1 -->|✅ Complete| AadhaarEntry1[Enter Aadhaar Number]:::input
    ManualFill1 --> AadhaarEntry1
    
    AadhaarEntry1 --> AadhaarFormat1{Aadhaar Format Check<br>12 digits, not starting 0/1}:::decision
    AadhaarFormat1 -->|❌ Invalid| AadhaarFormatError1[Show Format Error]:::stop
    AadhaarFormat1 -->|✅ Valid| AadhaarDuplicate1{Aadhaar Duplicate Check}:::aadhaarCheck
    
    AadhaarDuplicate1 -->|❌ Already Exists| AadhaarDuplicateError1[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    AadhaarDuplicate1 -->|✅ Unique| CrossVerify{Cross Verify<br>Last 4 digits match}:::decision
    
    CrossVerify -->|✅ Match| To_Common1[➡️ Proceed to Common Steps]:::common
    CrossVerify -->|❌ No Match| CrossError[Show Mismatch Error]:::stop
    
    AadhaarFormatError1 --> Stop3[🛑 STOP]:::stop
    AadhaarDuplicateError1 --> Stop4[🛑 STOP]:::stop
    CrossError --> Stop5[🛑 STOP]:::stop

    %% PATH A2 - MANUAL FALLBACK
    Path_A2 --> Message[Show Message:<br>PAN not linked with Aadhaar]:::manual
    Message --> AutoFill2[Auto-fill from PAN API<br>if available]:::manual
    AutoFill2 --> ManualFill2[Admin manually<br>enters all details]:::input
    ManualFill2 --> AadhaarEntry2[Enter Aadhaar Number]:::input
    AadhaarEntry2 --> AadhaarFormat2{Aadhaar Format Check<br>12 digits, not starting 0/1}:::decision
    AadhaarFormat2 -->|❌ Invalid| AadhaarFormatError2[Show Format Error]:::stop
    AadhaarFormat2 -->|✅ Valid| AadhaarDuplicate2{Aadhaar Duplicate Check}:::aadhaarCheck
    
    AadhaarDuplicate2 -->|❌ Already Exists| AadhaarDuplicateError2[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    AadhaarDuplicate2 -->|✅ Unique| To_Common2[➡️ Proceed to Common Steps]:::common
    
    AadhaarFormatError2 --> Stop6[🛑 STOP]:::stop
    AadhaarDuplicateError2 --> Stop7[🛑 STOP]:::stop

    %% PATH B - INSUFFICIENT BALANCE
    Path_B --> InsufficientMsg[Show: Insufficient Balance]:::manual
    InsufficientMsg --> ManualEntry_B[Manual Entry All Details]:::input
    ManualEntry_B --> PAN_Val_B{PAN Validation}:::decision
    PAN_Val_B -->|❌ Invalid| Stop8[🛑 STOP]:::stop
    PAN_Val_B -->|✅ Valid| AadhaarEntry_B[Enter Aadhaar Number]:::input
    
    AadhaarEntry_B --> AadhaarFormat_B{Aadhaar Format Check}:::decision
    AadhaarFormat_B -->|❌ Invalid| AadhaarFormatError_B[Show Format Error]:::stop
    AadhaarFormat_B -->|✅ Valid| AadhaarDuplicate_B{Aadhaar Duplicate Check}:::aadhaarCheck
    
    AadhaarDuplicate_B -->|❌ Already Exists| AadhaarDuplicateError_B[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    AadhaarDuplicate_B -->|✅ Unique| To_Common3[➡️ Proceed to Common Steps]:::common
    
    AadhaarFormatError_B --> Stop9[🛑 STOP]:::stop
    AadhaarDuplicateError_B --> Stop10[🛑 STOP]:::stop

    %% PATH C - API DOWN
    Path_C --> APIDownMsg[Show: PAN API Down]:::manual
    APIDownMsg --> ManualEntry_C[Manual Entry All Details]:::input
    ManualEntry_C --> PAN_Val_C{PAN Validation}:::decision
    PAN_Val_C -->|❌ Invalid| Stop11[🛑 STOP]:::stop
    PAN_Val_C -->|✅ Valid| AadhaarEntry_C[Enter Aadhaar Number]:::input
    
    AadhaarEntry_C --> AadhaarFormat_C{Aadhaar Format Check}:::decision
    AadhaarFormat_C -->|❌ Invalid| AadhaarFormatError_C[Show Format Error]:::stop
    AadhaarFormat_C -->|✅ Valid| AadhaarDuplicate_C{Aadhaar Duplicate Check}:::aadhaarCheck
    
    AadhaarDuplicate_C -->|❌ Already Exists| AadhaarDuplicateError_C[Show Error:<br>Retailer ABC ID-XXXX exists]:::stop
    AadhaarDuplicate_C -->|✅ Unique| To_Common4[➡️ Proceed to Common Steps]:::common
    
    AadhaarFormatError_C --> Stop12[🛑 STOP]:::stop
    AadhaarDuplicateError_C --> Stop13[🛑 STOP]:::stop

    %% === COMMON STEPS ===
    To_Common1 --> Common
    To_Common2 --> Common
    To_Common3 --> Common
    To_Common4 --> Common
    
    subgraph Common [📋 COMMON ONBOARDING STEPS]
        C1[Contact Details Entry<br>Mobile, Email, Address]:::common --> C2{Mobile & Email<br>Validation}:::decision
        C2 -->|✅ Format Valid| C3{Uniqueness Check}:::decision
        C3 -->|❌ Duplicate| C4[Show Error:<br>Mobile/Email already registered]:::stop
        C3 -->|✅ Unique| C5[Bank Details Entry<br>Account, IFSC, Bank Name]:::common
        
        C5 --> C6[Bank Validations<br>Account Verification]:::common
        C6 --> C7[Create Retailer Record<br>Generate Retailer ABC ID]:::common
    end
    
    C4 --> Stop14[🛑 STOP]:::stop
    C7 --> Status{Assign Final Status}:::decision

    %% === FINAL STATUS ===
    Status -->|From Path A1| Verified[✅ STATUS: VERIFIED<br>Green Badge - Non-clickable<br>Auto-filled fields LOCKED]:::verified
    Status -->|From Path A2/B/C| NotVerified[⚠️ STATUS: NOT VERIFIED<br>Gray Badge - Clickable<br>All fields editable]:::manual
    
    Verified --> End1[🎉 Onboarding Complete]:::startEnd
    NotVerified --> PostVerify[Post-Onboarding<br>Verification Available]:::manual
    
    PostVerify --> Click[Admin clicks 'Not Verified' badge]:::manual
    Click --> VerifyProcess{Run Verification Check}:::decision
    
    VerifyProcess -->|✅ PAN-Aadhaar Match| AutoVerify[Auto-Verify:<br>Verification Done]:::verified
    VerifyProcess -->|❌ PAN-Aadhaar Mismatch| Mismatch[Show: Details not matching<br>Admin can edit & retry]:::manual
    VerifyProcess -->|🔧 API Down| APIMessage[Show: API Down<br>Try again later]:::manual
    
    AutoVerify --> End2[🎉 Process Complete]:::startEnd
    Mismatch --> End3[🔄 Return to Edit]:::manual
    APIMessage --> End4[⏸️ Process Paused]:::manual
                        </div>
                    </div>
                </div>

                <!-- Fullscreen Overlay (hidden by default) -->
                <div id="fullscreenOverlay">
                    <div class="diagram-container">
                        <div class="diagram-controls">
                            <button class="control-btn close-fullscreen" onclick="toggleFullscreen()">
                                <span>✕</span> Exit Fullscreen
                            </button>
                        </div>
                        
                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="zoomOut()">-</button>
                            <button class="zoom-btn" onclick="resetZoom()">⟳</button>
                            <button class="zoom-btn" onclick="zoomIn()">+</button>
                        </div>

                        <div class="zoom-level" id="fullscreenZoomLevel">100%</div>
                        <div class="control-hint" id="fullscreenControlHint">Hold Ctrl + Mouse Wheel to Zoom | Click + Drag to Pan</div>
                        
                        <div class="diagram-wrapper" id="fullscreenDiagramWrapper">
                            <div class="mermaid" id="fullscreenDiagram">
                                <!-- Fullscreen diagram will be cloned here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Content Section -->
                <div class="additional-content">
                    <h3>Enhanced Process Features</h3>
                    <div class="content-grid">
                        <div class="content-block">
                            <h4>Universal Aadhaar Validation</h4>
                            <p>Comprehensive Aadhaar duplicate checking implemented across ALL onboarding paths including API failures and insufficient balance scenarios. Ensures no duplicate retailers can be created using the same Aadhaar number.</p>
                        </div>
                        <div class="content-block">
                            <h4>Multi-Path Architecture</h4>
                            <p>Automatically routes to appropriate flow based on system conditions while maintaining consistent validation standards across all paths. Provides business continuity during system failures.</p>
                        </div>
                        <div class="content-block">
                            <h4>Enhanced Security Protocols</h4>
                            <p>Both PAN and Aadhaar undergo rigorous format validation and system-wide duplicate checking. Cross-verification ensures data integrity and prevents identity fraud.</p>
                        </div>
                        <div class="content-block">
                            <h4>Status-Driven Processing</h4>
                            <p>Verification status determines field editability and post-onboarding capabilities. Automated field locking for verified data ensures data integrity after verification.</p>
                        </div>
                    </div>
                </div>

                <div class="flow-section">
                    <h3>Enhanced Aadhaar Validation Across All Paths</h3>
                    <p><strong>Universal Aadhaar Duplicate Checking:</strong> The system now performs comprehensive Aadhaar validation across ALL onboarding scenarios including:</p>
                    
                    <ul>
                        <li><strong>Verified Flow:</strong> Format validation + Duplicate check + Cross-verification with PAN data</li>
                        <li><strong>Manual Fallback:</strong> Format validation + Duplicate check when PAN-Aadhaar not linked</li>
                        <li><strong>API Failure:</strong> Format validation + Duplicate check when PAN API is unavailable</li>
                        <li><strong>Insufficient Balance:</strong> Format validation + Duplicate check when wallet balance is low</li>
                    </ul>
                    
                    <p>This enhancement ensures no duplicate retailers can be created using the same Aadhaar number, maintaining data integrity across all possible onboarding scenarios.</p>
                </div>

                <div class="enhanced-features">
                    <h3>System Security Enhancements</h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <h5>Cross-Verification System</h5>
                            <p>PAN-Aadhaar linking verification with last 4 digits matching for enhanced identity validation and fraud prevention</p>
                        </div>
                        <div class="feature-item">
                            <h5>Comprehensive Error Handling</h5>
                            <p>Graceful handling of API failures, insufficient funds, and data mismatches with clear user feedback and resolution paths</p>
                        </div>
                        <div class="feature-item">
                            <h5>Real-time Validation</h5>
                            <p>Each field validated in real-time with immediate user feedback and error resolution capabilities</p>
                        </div>
                        <div class="feature-item">
                            <h5>Post-Onboarding Verification</h5>
                            <p>Ability to verify retailers post-onboarding with automated status updates and field management</p>
                        </div>
                    </div>
                </div>

                <div class="note-box">
                    <p><strong>System Resilience:</strong> The onboarding process is designed to handle multiple failure scenarios gracefully, ensuring business continuity while maintaining data security and compliance standards. All manual paths include the same rigorous Aadhaar validation as automated paths.</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Retailer Onboarding Process Documentation | System Administration Guide | Enhanced with Universal Aadhaar Validation | Version 2.1</p>
        </footer>
    </div>

    <script>
        // Initialize Mermaid with responsive settings
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Zoom functionality
        let currentScale = 1;
        const diagram = document.getElementById('mainDiagram');
        const fullscreenDiagram = document.getElementById('fullscreenDiagram');
        const diagramWrapper = document.getElementById('diagramWrapper');
        const fullscreenDiagramWrapper = document.getElementById('fullscreenDiagramWrapper');
        const fullscreenOverlay = document.getElementById('fullscreenOverlay');
        const scrollHint = document.getElementById('scrollHint');
        const zoomLevel = document.getElementById('zoomLevel');
        const fullscreenZoomLevel = document.getElementById('fullscreenZoomLevel');
        const controlHint = document.getElementById('controlHint');
        const fullscreenControlHint = document.getElementById('fullscreenControlHint');

        // Pan functionality variables
        let isDragging = false;
        let startX, startY;
        let scrollLeft, scrollTop;

        // Show control hint temporarily
        function showControlHint() {
            const hint = fullscreenOverlay.classList.contains('active') ? fullscreenControlHint : controlHint;
            hint.classList.add('show');
            setTimeout(() => {
                hint.classList.remove('show');
            }, 3000);
        }

        // Ensure diagram fits container on initial load
        function fitDiagramToContainer() {
            const container = diagramWrapper;
            const diagramElement = diagram;
            
            // Reset scale
            currentScale = 1;
            diagramElement.style.transform = `scale(${currentScale})`;
            diagramElement.style.transformOrigin = '0 0';
            
            // Center the diagram
            centerView();
            updateZoomLevel();
        }

        function updateZoomLevel() {
            const level = Math.round(currentScale * 100);
            zoomLevel.textContent = `${level}%`;
            fullscreenZoomLevel.textContent = `${level}%`;
        }

        function zoomIn() {
            if (currentScale < 3) {
                currentScale += 0.1;
                updateZoom();
                showControlHint();
            }
        }

        function zoomOut() {
            if (currentScale > 0.5) {
                currentScale -= 0.1;
                updateZoom();
                showControlHint();
            }
        }

        function resetZoom() {
            currentScale = 1;
            updateZoom();
            // Center the view
            centerView();
            showControlHint();
        }

        function updateZoom() {
            const targetDiagram = fullscreenOverlay.classList.contains('active') ? fullscreenDiagram : diagram;
            targetDiagram.style.transform = `scale(${currentScale})`;
            targetDiagram.style.transformOrigin = '0 0';
            updateZoomLevel();
        }

        function centerView() {
            const wrapper = fullscreenOverlay.classList.contains('active') 
                ? fullscreenDiagramWrapper 
                : diagramWrapper;
            
            if (wrapper) {
                const diagramElement = fullscreenOverlay.classList.contains('active') 
                    ? fullscreenDiagram 
                    : diagram;
                
                const scaledWidth = diagramElement.scrollWidth * currentScale;
                const scaledHeight = diagramElement.scrollHeight * currentScale;
                
                // Calculate center position
                const scrollLeft = (scaledWidth - wrapper.clientWidth) / 2;
                const scrollTop = (scaledHeight - wrapper.clientHeight) / 2;
                
                wrapper.scrollTo({
                    left: Math.max(0, scrollLeft),
                    top: Math.max(0, scrollTop),
                    behavior: 'smooth'
                });
            }
        }

        // Mouse wheel zoom functionality (Ctrl + Wheel)
        function handleMouseWheel(e) {
            if (e.ctrlKey) {
                e.preventDefault();
                
                if (e.deltaY < 0) {
                    // Zoom in
                    zoomIn();
                } else {
                    // Zoom out
                    zoomOut();
                }
                return;
            }
            
            // Normal scrolling when Ctrl is not pressed
            const wrapper = fullscreenOverlay.classList.contains('active') 
                ? fullscreenDiagramWrapper 
                : diagramWrapper;
            
            if (wrapper) {
                wrapper.scrollLeft += e.deltaX;
                wrapper.scrollTop += e.deltaY;
            }
        }

        // Mouse drag pan functionality
        function startDrag(e) {
            const wrapper = fullscreenOverlay.classList.contains('active') 
                ? fullscreenDiagramWrapper 
                : diagramWrapper;
            
            isDragging = true;
            wrapper.classList.add('grabbing');
            
            startX = e.pageX - wrapper.offsetLeft;
            startY = e.pageY - wrapper.offsetTop;
            scrollLeft = wrapper.scrollLeft;
            scrollTop = wrapper.scrollTop;
            
            // Prevent text selection while dragging
            e.preventDefault();
        }

        function duringDrag(e) {
            if (!isDragging) return;
            
            const wrapper = fullscreenOverlay.classList.contains('active') 
                ? fullscreenDiagramWrapper 
                : diagramWrapper;
            
            const x = e.pageX - wrapper.offsetLeft;
            const y = e.pageY - wrapper.offsetTop;
            const walkX = (x - startX) * 2; // Multiply for better panning
            const walkY = (y - startY) * 2;
            
            wrapper.scrollLeft = scrollLeft - walkX;
            wrapper.scrollTop = scrollTop - walkY;
        }

        function stopDrag() {
            isDragging = false;
            const wrapper = fullscreenOverlay.classList.contains('active') 
                ? fullscreenDiagramWrapper 
                : diagramWrapper;
            
            wrapper.classList.remove('grabbing');
        }

        // Fullscreen functionality
        function toggleFullscreen() {
            if (!fullscreenOverlay.classList.contains('active')) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            // Clone the diagram content to fullscreen overlay
            fullscreenDiagram.innerHTML = diagram.innerHTML;
            
            // Show fullscreen overlay
            fullscreenOverlay.classList.add('active');
            
            // Reset zoom for fullscreen
            currentScale = 1;
            updateZoom();
            
            // Center the view
            setTimeout(centerView, 100);
            
            // Add event listeners for fullscreen
            document.addEventListener('keydown', handleFullscreenKeydown);
            fullscreenDiagramWrapper.addEventListener('wheel', handleMouseWheel, { passive: false });
            fullscreenDiagramWrapper.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', duringDrag);
            document.addEventListener('mouseup', stopDrag);
            
            // Show control hint
            showControlHint();
            
            // Re-initialize mermaid for the fullscreen diagram
            setTimeout(() => {
                mermaid.init(undefined, document.querySelectorAll('#fullscreenDiagram'));
            }, 100);
        }

        function exitFullscreen() {
            // Hide fullscreen overlay
            fullscreenOverlay.classList.remove('active');
            
            // Reset zoom for main view
            currentScale = 1;
            updateZoom();
            
            // Center the main view
            centerView();
            
            // Remove event listeners
            document.removeEventListener('keydown', handleFullscreenKeydown);
            fullscreenDiagramWrapper.removeEventListener('wheel', handleMouseWheel);
            fullscreenDiagramWrapper.removeEventListener('mousedown', startDrag);
            document.removeEventListener('mousemove', duringDrag);
            document.removeEventListener('mouseup', stopDrag);
        }

        function handleFullscreenKeydown(e) {
            if (e.key === 'Escape' && fullscreenOverlay.classList.contains('active')) {
                exitFullscreen();
            }
        }

        // Hide scroll hint after 5 seconds
        setTimeout(() => {
            if (scrollHint) {
                scrollHint.style.opacity = '0';
                setTimeout(() => {
                    scrollHint.style.display = 'none';
                }, 1000);
            }
        }, 5000);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '=':
                    case '+':
                        e.preventDefault();
                        zoomIn();
                        break;
                    case '-':
                        e.preventDefault();
                        zoomOut();
                        break;
                    case '0':
                        e.preventDefault();
                        resetZoom();
                        break;
                }
            }
        });

        // Initialize diagram
        window.addEventListener('load', function() {
            // Fit diagram to container initially
            setTimeout(fitDiagramToContainer, 500);
            updateZoomLevel();
            
            // Add event listeners for main diagram
            diagramWrapper.addEventListener('wheel', handleMouseWheel, { passive: false });
            diagramWrapper.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', duringDrag);
            document.addEventListener('mouseup', stopDrag);
            
            // Re-initialize mermaid for the main diagram
            mermaid.init(undefined, document.querySelectorAll('#mainDiagram'));
        });
    </script>
</body>
</html>
